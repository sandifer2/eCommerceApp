<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Maui.eCommerce.Views.ShoppingManagementView"
             Title="Shopping Management"
             NavigatedTo="ContentPage_NavigatedTo">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Cart management section -->
        <Grid Grid.Row="0" Padding="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <Label Grid.Row="0" 
                   Text="{Binding CurrentCartName, StringFormat='Current Cart: {0}'}" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   Margin="0,0,0,10"/>
            
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <Frame Grid.Column="0" Padding="5" Margin="0,5,5,5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <Button Grid.Column="0"
                                Text="{Binding SelectedCartName, StringFormat='Select: {0}'}"
                                Clicked="ShowCartSelectionClicked"
                                HorizontalOptions="FillAndExpand"/>
                        
                        <Button Grid.Column="1" 
                                Text="Switch" 
                                Clicked="SwitchCartClicked"
                                Margin="5,0,0,0"/>
                    </Grid>
                </Frame>
                
                <Frame Grid.Column="1" Padding="5" Margin="5,5,0,5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <Entry Grid.Column="0" 
                               Placeholder="New Cart Name" 
                               Text="{Binding NewCartName}"/>
                        
                        <Button Grid.Column="1" 
                                Text="Create" 
                                Clicked="CreateCartClicked"
                                Margin="5,0,0,0"/>
                    </Grid>
                </Frame>
            </Grid>
        </Grid>
        
        <!-- Sorting controls -->
        <Grid Grid.Row="1" Padding="10,0,10,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition/>
                <ColumnDefinition/>
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0" 
                    Text="Sort by Name" 
                    Clicked="SortByNameClicked"
                    Margin="0,0,5,0"/>
            <Button Grid.Column="1" 
                    Text="Sort by Price" 
                    Clicked="SortByPriceClicked"
                    Margin="5,0,0,0"/>
        </Grid>
        
        <!-- Main content grid -->
        <Grid Grid.Row="2" Padding="10">   
            <Grid.ColumnDefinitions>
                <ColumnDefinition/><!--Store-->
                <ColumnDefinition/><!--Shopping Cart-->
            </Grid.ColumnDefinitions>
            
            <!-- Store -->
            <Grid Grid.Column="0" Margin="0,0,5,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <Label Grid.Row="0" 
                       Text="Available Products" 
                       FontSize="16" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center"
                       Margin="0,0,0,5"/>
                
                <ListView Grid.Row="1"
                    ItemsSource="{Binding Inventory}"
                    SelectedItem="{Binding SelectedItem}">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <ViewCell>
                                <Grid Padding="5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0" Text="{Binding Id}" VerticalOptions="Center"/>
                                    <Label Grid.Column="1" Text="{Binding Product.Name}" VerticalOptions="Center"/>
                                    <Label Grid.Column="2" Text="{Binding Product.Price, StringFormat='${0:F2}'}" VerticalOptions="Center"/>
                                    <Label Grid.Column="3" Text="{Binding Quantity}" VerticalOptions="Center" Margin="5,0"/>
                                    <Button Grid.Column="4" Text="Add" Command="{Binding AddCommand}" Clicked="InlineAddClicked"/>
                                </Grid>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.ItemTemplate>  
                </ListView>
                
                <Button Grid.Row="2" 
                        Text="Add Selected to Cart" 
                        Clicked="AddToCartClicked"
                        Margin="0,5,0,5"/>
                        
                <Button Grid.Row="3" 
                        Text="Back to Home" 
                        Clicked="BackToHomeClicked"/>
            </Grid>    
            
            <!-- Shopping Cart -->
            <Grid Grid.Column="1" Margin="5,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <Label Grid.Row="0" 
                       Text="Shopping Cart" 
                       FontSize="16" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center"
                       Margin="0,0,0,5"/>
                       
                <ListView Grid.Row="1"
                          ItemsSource="{Binding ShoppingCart}"
                          SelectedItem="{Binding SelectedCartItem}">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <ViewCell>
                                <Grid Padding="5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Label Grid.Column="0" Text="{Binding Id}" VerticalOptions="Center"/>
                                    <Label Grid.Column="1" Text="{Binding Product.Name}" VerticalOptions="Center"/>
                                    <Label Grid.Column="2" Text="{Binding Product.Price, StringFormat='${0:F2}'}" VerticalOptions="Center"/>
                                    <Label Grid.Column="3" Text="{Binding Quantity}" VerticalOptions="Center" Margin="5,0"/>
                                </Grid>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
                
                <Button Grid.Row="2" 
                        Text="Remove Selected" 
                        Clicked="RemoveFromCartClicked"
                        Margin="0,5,0,5"/>
                        
                <Button Grid.Row="3" 
                        Text="Checkout" 
                        Clicked="CheckoutClicked"/>
            </Grid>        
        </Grid>
    </Grid> 
</ContentPage>